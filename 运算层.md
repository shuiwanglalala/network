# 运算层

[TCP 为什么是三次握手，而不是两次或四次？](https://mp.weixin.qq.com/s/NIjxgx4NPn7FC4PfkHBAAQ)

终于讲清楚了，太棒了

TCP看似复杂，其实可以归纳为以下5种报文：

**（1）**   **SYN**

**（2）**   **Data** **（唯一携带用户数据）**

**（3）**   **FIN**

**（4）**   **Reset**

**（5）**   **ACK**

其中1、2、3分别为**建立连接、数据传输、断开连接**，这三种报文对方接收到一定要ACK确认，为何要确认，因为这就是可靠传输的依赖的机制。如果对方在超时时间内不确认，发送方会一直重传，直到对方确认为止、或到达重传上限次数而Reset连接。

4、5 为**重置连接报文、确认ACK报文**，这两种报文对方接收到要ACK确认吧？不需要！自然发送方也不会重传这2种类型的报文

**一句话概括，TCP连接握手，握的是啥？**

**通信双方数据原点的序列号！**

**第一个包，即A发给B的SYN 中途被丢，没有到达B**

A会周期性超时重传，直到收到B的确认

**第二个包，即B发给A的SYN +ACK 中途被丢，没有到达A**

B会周期性超时重传，直到收到A的确认

**第三个包，即A发给B的ACK 中途被丢，没有到达B**

A发完ACK，单方面认为TCP为 Established状态，而B显然认为TCP为Active状态：

a. 假定此时双方都没有数据发送，B会周期性超时重传，直到收到A的确认，收到之后B的TCP 连接也为 Established状态，双向可以发包。

b. 假定此时A有数据发送，B收到A的 Data + ACK，自然会切换为established 状态，并接受A的Data。

c. 假定B有数据发送，数据发送不了，会一直周期性超时重传SYN + ACK，直到收到A的确认才可以发送数据。

